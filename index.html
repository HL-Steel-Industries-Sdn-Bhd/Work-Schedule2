<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>项目排班表</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    padding: 15px;
    background-color: #f5f7fa;
    color: #333;
    line-height: 1.5;
}
h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
h3 { margin: 25px 0 15px; color: #34495e; }
.container {
    max-width: 100%;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 20px;
    overflow-x: auto;
}

/* 新增日期+标题栏样式 */
.top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}
.date-box {
    padding: 8px 12px;
    background: #2ecc71;
    color: white;
    border-radius: 6px;
    font-weight: bold;
    font-size: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.schedule-container { 
    display: flex; 
    gap: 20px; 
    margin-bottom: 30px; 
    position: relative;
}
.projects-sidebar { width: 150px; flex-shrink: 0; }
.project {
    padding: 12px 15px;
    background: #e74c3c;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 10px;
    font-size: 16px;
    user-select: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
    text-align: center;
}
.project:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.project.dragging { opacity: 0.8; transform: scale(1.05); box-shadow: 0 3px 6px rgba(0,0,0,0.2); }

.schedule { 
    display: grid; 
    grid-template-columns: 100px repeat(10, 1fr); 
    border: 1px solid #ddd; 
    border-radius: 8px; 
    overflow: hidden; 
    width: 100%;
}
.cell {
    border: 1px solid #eee;
    min-height: 50px;
    position: relative;
    transition: background 0.2s;
}
.cell:hover { background: #f9f9f9; }
.cell.active { background: #e1f5fe !important; }

.header {
    background: #3498db;
    color: white;
    text-align: center;
    font-weight: bold;
    padding: 10px 0;
}
.person { background: #ecf0f1; text-align: center; font-weight: bold; }
.assigned-project {
    position: absolute;
    top: 5px; bottom: 5px; left: 5px; right: 5px;
    background: #2ecc71;
    color: white;
    border-radius: 5px;
    display: flex;
    align-items: center; 
    justify-content: center;
    cursor: pointer;
    font-size: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    overflow: hidden;
    white-space: nowrap;
}
.assigned-project span {
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 5px;
}

.instructions {
    background: #f9f9f9;
    border-left: 4px solid #3498db;
    padding: 15px;
    border-radius: 6px;
    font-size: 14px;
    color: #555;
    margin-top: 20px;
}
.instructions h4 { margin-bottom: 10px; color: #2c3e50; }
.instructions ul { margin-left: 20px; }

@media (max-width: 768px) {
    .schedule-container { flex-direction: column; }
    .projects-sidebar { width: 100%; }
    .schedule { grid-template-columns: 25% repeat(10, 7.5%); }
    .project, .assigned-project { font-size: 14px; }
}
</style>
</head>
<body>
<div class="container">
    <div class="top-bar">
        <div class="date-box">2025-09-24</div>
        <h2>项目排班表</h2>
    </div>

    <div class="schedule-container">
        <div class="projects-sidebar">
            <h3>可分配项目</h3>
            <div id="projects"></div>
        </div>
        <div class="schedule" id="schedule"></div>
    </div>
    <div class="instructions">
        <h4>使用说明</h4>
        <ul>
            <li><strong>新交互方式</strong>: 先点击选择起始单元格（绿色高亮），然后拖拽项目到该单元格</li>
            <li>项目会从选定的起始单元格开始，向右延伸到您拖拽的结束位置</li>
            <li>每个格子只能分配一个项目</li>
            <li>点击已分配的项目可以将其从排班表中移除</li>
            <li>点击其他单元格可以更改起始位置</li>
        </ul>
    </div>
</div>

<script>
const persons = ["员工A", "员工B", "员工C", "员工D"];
const times = ["8:00", "9:00", "10:00", "11:00", "12:00", 
               "13:00", "14:00", "15:00", "16:00", "17:00"];
const projectsList = ["项目1", "项目2", "项目3", "项目4", "项目5"];

const projectsContainer = document.getElementById("projects");
projectsList.forEach(proj => {
    const div = document.createElement("div");
    div.className = "project";
    div.textContent = proj;
    div.draggable = true;
    div.addEventListener("dragstart", (e) => {
        div.classList.add("dragging");
        e.dataTransfer.setData("text/plain", proj);
    });
    div.addEventListener("dragend", () => {
        div.classList.remove("dragging");
    });
    projectsContainer.appendChild(div);
});

const schedule = document.getElementById("schedule");
schedule.innerHTML = '<div class="header">人员/时间</div>';
times.forEach(t => {
    schedule.innerHTML += '<div class="header">' + t + '</div>';
});
persons.forEach(person => {
    schedule.innerHTML += '<div class="person">' + person + '</div>';
    times.forEach(t => {
        schedule.innerHTML += '<div class="cell" data-person="' + person + '" data-time="' + t + '"></div>';
    });
});

let activeCell = null;
const cells = document.querySelectorAll(".cell");

cells.forEach(cell => {
    cell.addEventListener("click", () => {
        if (activeCell) activeCell.classList.remove("active");
        activeCell = cell;
        activeCell.classList.add("active");
    });
    cell.addEventListener("dragover", (e) => {
        e.preventDefault();
        if (activeCell) cell.style.background = "#d0f0c0";
    });
    cell.addEventListener("dragleave", () => {
        cell.style.background = "";
    });
    cell.addEventListener("drop", (e) => {
        e.preventDefault();
        cell.style.background = "";
        const projectName = e.dataTransfer.getData("text/plain");
        if (!activeCell) { alert("请先选择起始单元格"); return; }

        const person = activeCell.dataset.person;
        const startTime = times.indexOf(activeCell.dataset.time);
        const endTime = times.indexOf(cell.dataset.time);

        if (person !== cell.dataset.person || endTime < startTime) {
            alert("请在同一行从左到右拖拽");
            return;
        }

        for (let i = startTime; i <= endTime; i++) {
            const targetCell = document.querySelector(
                '.cell[data-person="' + person + '"][data-time="' + times[i] + '"]'
            );
            if (targetCell.querySelector(".assigned-project")) {
                alert("部分时间段已有项目");
                return;
            }
        }

        for (let i = startTime; i <= endTime; i++) {
            const targetCell = document.querySelector(
                '.cell[data-person="' + person + '"][data-time="' + times[i] + '"]'
            );
            const projDiv = document.createElement("div");
            projDiv.className = "assigned-project";
            if (i === startTime) projDiv.innerHTML = "<span>" + projectName + "</span>";
            targetCell.appendChild(projDiv);
            projDiv.addEventListener("click", () => {
                for (let j = startTime; j <= endTime; j++) {
                    const c = document.querySelector(
                        '.cell[data-person="' + person + '"][data-time="' + times[j] + '"]'
                    );
                    if (c.firstChild) c.removeChild(c.firstChild);
                }
            });
        }
        activeCell.classList.remove("active");
        activeCell = null;
    });
});
</script>
</body>
</html>



